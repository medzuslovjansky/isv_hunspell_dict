#!/usr/bin/env zx

const [headers, ...rows] = (await fs.readFile(`out/bench.dat`, 'utf8'))
  .split('\n')
  .filter(Boolean)
  .map(line => line
    .split('\t')
    .map(x => isFinite(+x) ? +x : x)
  );

const bar = require('ervy/lib/bar')
const { bg, fg } = require('ervy/lib/utils')

// Bar
const barData = rows.map(([language, correct, misspelled]) => ( 
  {
    key: language
      .replace('art-x-interslv', '/combined')
      .replace('art-Latn-x-interslv', '/latin')
      .replace('art-Cyrl-x-interslv', '/cyrillic')
      .replace(/^(..)$/, 'dictionary-$1'),
    value: Math.floor(0.5 * (correct + misspelled) * 1E-3),
    style: language.startsWith('art-') ? bg('red') : bg('blue'),
  }
));

console.log('Performance')
console.log('1,000 non-whitespace characters per second\n')
console.log(bar(barData, { barWidth: 5, padding: 9, height: 12 }))
